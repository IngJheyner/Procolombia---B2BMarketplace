/**
 * @file
 * Global utilities.
 *
 */

(function($, Drupal) {
    'use strict';

    /**
     * Certif_scroll
     * @return {[type]} [description]
     */
    function add_scroll_class_to_certific() {
        if ($('body').hasClass('node--type-product')) {
            let $ctn_certif = $('.field--name-field-file-certifications'),
                $ctn_certif_items = $ctn_certif.find('.field__items'),
                $certif_items = $ctn_certif_items.find('.field__item');
            if ($certif_items.length > 4) {
                $ctn_certif_items.addClass('certific-items-scroll');
            }
        }
    }

    /**
     * change_company_link_see_more_products
     * Change href attribute in company link 'see more products'
     */
    function change_company_link_see_more_products() {
        if ($('body').hasClass('node--type-product')) {
            if ($('#block-views-block-company-view-detail-product-block-1').length > 0) {
                let link_title = $('.block-content-company .title a');
                if (link_title.length > 0) {
                    let href_title = link_title.attr('href'),
                        link_see_more = $('.block-buttons .btn-primary'),
                        id_products_blocks = $('.id-block-products').attr('data-id');
                    link_see_more.attr('href', href_title + '#' + id_products_blocks);
                }
            }
        }
    }

    /**
     * login_header
     * @return {[type]} [description]
     */
    function login_header(context) {
        // Login Header
        $('.inicio-sesion', context).once('loginHeader').click(function(e) {
            e.preventDefault();
            $('.block-custom-login').toggleClass('is-hidden');
        })

        // Close login header
        $('.block-custom-login .link-close', context).once('closeLoginHeader').click(function(e) {
            e.preventDefault();
            $('.block-custom-login').toggleClass('is-hidden');
        })
    }


    /**
     * remove_white_space_in_product_and_company
     * @return {[type]} [description]
     */
    function remove_white_space_in_view_detail_product_and_company() {
        var view = null;
        if ($('body').hasClass('node--type-company')) {
            view = $('.products-list-detail-company');
        }
        if ($('body').hasClass('node--type-product')) {
            view = $('.company-view-detail-product');
        }
        if (view != null && view.find('.view-content').length == 0) {
            view.parents('.content-bottom').addClass('hidden');
        }
    }


    /**
     * Behaviors
     */
    Drupal.behaviors.global = {
        attach: function(context) {

            // Add scroll class to certifications in product detail
            add_scroll_class_to_certific();

            // Change link to company "See more products" (Product detail)
            change_company_link_see_more_products();

            // Login header
            login_header(context);

            // Drupal Messages
            if ($('.prepend-messages').length === 0) {
                $('.highlighted').find('.alert').removeClass('is-hidden');
            }

            // Body scroll
            $(window).scroll(function() {
                if ($(this).scrollTop() > 50) {
                    $('body').addClass("scrolled");
                } else {
                    $('body').removeClass("scrolled");
                }
            });

            // Autocomplete off
            $('body').find('input[type=password]').attr('autocomplete', 'off');


            // Menu mobile
            $('#mobileNav').click(function(e) {
                $('.header-mobile-menu').toggleClass('is-hidden');
            })

            // Product Detail
            if ($('body').hasClass('node--type-product')) {
                $('.product-certifications').click(function(e) {
                    e.preventDefault();
                    $(this).parent().next().toggleClass('is-hidden');
                    $(this).toggleClass('expand');
                })
            }

            // Popup message
            if ($('.popup-message').length > 0) {
                $('body').addClass('exist-modal');
            }

            // Company and product detail
            if ($('body').hasClass('node--type-product') || $('body').hasClass('node--type-company')) {
                // Company form contact message
                if ($('.company-confirmation-message').length > 0) {
                    $('.company-confirmation-message .close').click(function(e) {
                        e.preventDefault();
                        window.location.reload(true);
                    })
                }
            }

            // Remove white space when not results in view company detail
            remove_white_space_in_view_detail_product_and_company();
            
        }
    }
}(jQuery, Drupal));